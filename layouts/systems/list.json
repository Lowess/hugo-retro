{{- /* Systems section index - lists all available systems */ -}}
{{- $systems := slice -}}

{{- range $key, $value := site.Data -}}
  {{- $systemId := $key -}}
  {{- $systemName := $systemId -}}

  {{- /* Get friendly name from params if available */ -}}
  {{- if isset site.Params.systemNames $systemId -}}
    {{- $systemName = index site.Params.systemNames $systemId -}}
  {{- else -}}
    {{- $systemName = $systemId | title -}}
  {{- end -}}

  {{- /* Count games for this system */ -}}
  {{- $gameCount := 0 -}}
  {{- if isset $value "gamelist" -}}
    {{- $gamelistData := index $value "gamelist" -}}
    {{- if isset $gamelistData "game" -}}
      {{- $gameCount = len $gamelistData.game -}}
    {{- end -}}
  {{- end -}}

  {{- /* Get color theme if available */ -}}
  {{- $color := "" -}}
  {{- if isset site.Params.systemColors $systemId -}}
    {{- $color = index site.Params.systemColors $systemId -}}
  {{- end -}}

  {{- $system := dict "id" $systemId "name" $systemName "gameCount" $gameCount "color" $color -}}
  {{- $systems = $systems | append $system -}}
{{- end -}}

{{- /* Add synthetic "all" system */ -}}
{{- $allColor := "" -}}
{{- if isset site.Params.systemColors "all" -}}
  {{- $allColor = index site.Params.systemColors "all" -}}
{{- end -}}
{{- $allSystem := dict "id" "all" "name" "All Systems" "color" $allColor -}}
{{- $systems = slice $allSystem | append $systems -}}

{{- $systems | jsonify -}}
